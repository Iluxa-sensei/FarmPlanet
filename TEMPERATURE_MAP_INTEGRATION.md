# ๐ก๏ธ Temperature Map Integration with Territories

## ๐ ะะพะฒะฐั ััะฝะบัะธะพะฝะฐะปัะฝะพััั

### ะัะพะฑะปะตะผะฐ:
ะัะธ ะฟะตัะตะบะปััะตะฝะธะธ ะฝะฐ ัะตะผะฟะตัะฐัััะฝัั ะบะฐััั ัะตััะธัะพัะธะธ ะฝะต ะพัะพะฑัะฐะถะฐะปะธัั, ะธ ะฝะตะปัะทั ะฑัะปะพ ะฟะพัะผะพััะตัั ัะตะผะฟะตัะฐัััั ะฝะฐ ัะตัะผะต.

### ะะตัะตะฝะธะต:
โ ะขะตััะธัะพัะธะธ ัะตะฟะตัั ะพัะพะฑัะฐะถะฐัััั ะฝะฐ ัะตะผะฟะตัะฐัััะฝะพะน ะบะฐััะต
โ ะัะธ ะบะปะธะบะต ะฝะฐ ัะตััะธัะพัะธั ะฟะพะบะฐะทัะฒะฐะตััั ัะตะบััะฐั ัะตะผะฟะตัะฐัััะฐ
โ ะ sidebar ัะฟะธัะพะบ ะฒัะตั ัะตััะธัะพัะธะน ั ะธั ัะตะผะฟะตัะฐัััะฐะผะธ
โ ะขะตะผะฟะตัะฐัััะฐ ะพะบัะฐัะธะฒะฐะตััั ะฒ ัะพะพัะฒะตัััะฒัััะธะน ัะฒะตั (ัะพะปะพะดะฝะพ โ ัะตะฟะปะพ)

## ๐ง ะขะตัะฝะธัะตัะบะธะต ะดะตัะฐะปะธ

### 1. ะคัะฝะบัะธั ัะฐััััะฐ ัะตะผะฟะตัะฐัััั ัะตััะธัะพัะธะธ

```typescript
const getTerritoryTemperature = (territory: Territory): number | null => {
  if (tempPoints.length === 0 || !territory.points || territory.points.length === 0) 
    return null;

  // 1. ะััะธัะปัะตะผ ัะตะฝัั ัะตััะธัะพัะธะธ
  const lats = territory.points.map(p => p[0]);
  const lngs = territory.points.map(p => p[1]);
  const centerLat = lats.reduce((a, b) => a + b, 0) / lats.length;
  const centerLng = lngs.reduce((a, b) => a + b, 0) / lngs.length;

  // 2. ะะฐัะพะดะธะผ ะฑะปะธะถะฐะนััั ัะพัะบั ัะตะผะฟะตัะฐัััั
  let nearestPoint = tempPoints[0];
  let minDistance = Infinity;

  tempPoints.forEach(point => {
    const distance = Math.sqrt(
      Math.pow(point.lat - centerLat, 2) + 
      Math.pow(point.lng - centerLng, 2)
    );
    if (distance < minDistance) {
      minDistance = distance;
      nearestPoint = point;
    }
  });

  return nearestPoint.value;
};
```

**ะะปะณะพัะธัะผ:**
1. ะััะธัะปัะตััั ัะตะฝัั ัะตััะธัะพัะธะธ (ััะตะดะฝะตะต ะฒัะตั ะบะพะพัะดะธะฝะฐั ัะพัะตะบ)
2. ะะปั ะบะฐะถะดะพะน ัะพัะบะธ ัะตะผะฟะตัะฐัััั ัะฐัััะธััะฒะฐะตััั ัะฐัััะพัะฝะธะต ะดะพ ัะตะฝััะฐ
3. ะะพะทะฒัะฐัะฐะตััั ัะตะผะฟะตัะฐัััะฐ ะธะท ะฑะปะธะถะฐะนัะตะน ัะพัะบะธ

### 2. ะัะพะฑัะฐะถะตะฝะธะต ะฝะฐ ะบะฐััะต

**ะะพะปะธะณะพะฝั ัะตััะธัะพัะธะน:**
```typescript
<Polygon
  positions={territory.points}
  pathOptions={{
    color: getTerritoryColor(index),
    fillColor: getTerritoryColor(index),
    fillOpacity: 0.3,
    weight: 3
  }}
  eventHandlers={{
    click: () => setSelectedTerritory(territory)
  }}
>
```

**Popup ั ัะตะผะฟะตัะฐัััะพะน:**
```typescript
<Popup>
  <div className="p-2 min-w-[200px]">
    <h3 className="font-bold text-lg mb-2">{territory.name}</h3>
    
    {/* ะขะตะผะฟะตัะฐัััะฐ ั ะณัะฐะดะธะตะฝัะฝัะผ ัะพะฝะพะผ */}
    <div className="mb-2 p-2 rounded-lg bg-gradient-to-r from-blue-500/20 to-red-500/20">
      <div className="flex items-center gap-2">
        <Thermometer className="w-5 h-5" />
        <div>
          <p className="text-xs text-muted-foreground">Current Temperature</p>
          <p className="text-2xl font-bold" style={{ 
            color: tempToColor(territoryTemp) 
          }}>
            {territoryTemp.toFixed(1)}ยฐC
          </p>
        </div>
      </div>
    </div>
    
    {/* ะะปะพัะฐะดั, ะบัะปััััะฐ, ะดะฐัะฐ ะฟะพัะฐะดะบะธ */}
    ...
  </div>
</Popup>
```

### 3. Sidebar ั ัะตะผะฟะตัะฐัััะฐะผะธ

```typescript
<Card className="glass-card">
  <CardHeader>
    <CardTitle className="text-sm">Territories Temperature</CardTitle>
    <CardDescription>Current temperature for your farms</CardDescription>
  </CardHeader>
  <CardContent>
    <ScrollArea className="h-[250px]">
      {territories.map((territory, index) => {
        const temp = getTerritoryTemperature(territory);
        return (
          <div onClick={() => setSelectedTerritory(territory)}>
            <p className="font-semibold text-sm">{territory.name}</p>
            <p className="text-lg font-bold" style={{ color: tempToColor(temp) }}>
              {temp.toFixed(1)}ยฐC
            </p>
          </div>
        );
      })}
    </ScrollArea>
  </CardContent>
</Card>
```

## ๐จ ะฆะฒะตัะพะฒะฐั ัะบะฐะปะฐ ัะตะผะฟะตัะฐัััั

ะัะฟะพะปัะทัะตััั ััะฝะบัะธั `tempToColor()`:

| ะขะตะผะฟะตัะฐัััะฐ | ะฆะฒะตั | Hex |
|-------------|------|-----|
| < -20ยฐC | ะขัะผะฝะพ-ัะธะฝะธะน | #000080 |
| -10ยฐC | ะกะธะฝะธะน | #0000CD |
| 0ยฐC | ะกะฒะตัะปะพ-ัะธะฝะธะน | #4169E1 |
| 10ยฐC | ะะพะปัะฑะพะน | #00BFFF |
| 15ยฐC | ะะธััะทะพะฒัะน | #87CEEB |
| 20ยฐC | ะกะฒะตัะปะพ-ะทะตะปัะฝัะน | #98FB98 |
| 25ยฐC | ะัะปััะน | #FFD700 |
| 30ยฐC | ะัะฐะฝะถะตะฒัะน | #FFA500 |
| 35ยฐC | ะขัะผะฝะพ-ะพัะฐะฝะถะตะฒัะน | #FF8C00 |
| > 40ยฐC | ะัะฐัะฝัะน | #DC143C |

## ๐ผ๏ธ ะะธะทัะฐะปัะฝัะต ัะปะตะผะตะฝัั

### Popup ัะตััะธัะพัะธะธ:
```
โโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Territory Name         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโค
โ ๐ก๏ธ Current Temperatureโ
โ     25.3ยฐC             โ
โ  (ัะฒะตั ะทะฐะฒะธัะธั ะพั tยฐ)  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโค
โ ๐ Area: 125.5 ะณะฐ      โ
โ ๐พ Wheat               โ
โ ๐ 10/15/2024          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### Sidebar ัะปะตะผะตะฝั:
```
โโโโโโโโโโโโโโโโโโโโโโโโโโ
โ โ Territory Name       โ
โ   Wheat         25.3ยฐC โ
โโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## ๐ฏ ะะพะปัะทะพะฒะฐัะตะปััะบะธะต ััะตะฝะฐัะธะธ

### ะกัะตะฝะฐัะธะน 1: ะัะพัะผะพัั ัะตะผะฟะตัะฐัััั ัะตัะผั
1. ะัะบัะพะนัะต **Map** ัััะฐะฝะธัั
2. ะะตัะตะบะปััะธัะตัั ะฝะฐ **Temperature Map**
3. ะะพะถะดะธัะตัั ะทะฐะณััะทะบะธ ัะตะผะฟะตัะฐัััะฝัั ะดะฐะฝะฝัั
4. ะะปะธะบะฝะธัะต ะฝะฐ ะฒะฐัั ัะตััะธัะพัะธั
5. ะ popup ะฒะธะดะธัะต ัะตะบัััั ัะตะผะฟะตัะฐัััั

### ะกัะตะฝะฐัะธะน 2: ะกัะฐะฒะฝะตะฝะธะต ัะตะผะฟะตัะฐััั
1. ะะตัะตะบะปััะธัะตัั ะฝะฐ **Temperature Map**
2. ะะพัะผะพััะธัะต sidebar **"Territories Temperature"**
3. ะะธะดะธัะต ัะตะผะฟะตัะฐัััั ะฒัะตั ะฒะฐัะธั ัะตััะธัะพัะธะน
4. ะะปะธะบะฝะธัะต ะฝะฐ ะปัะฑัั ะดะปั ะดะตัะฐะปัะฝะพะน ะธะฝัะพัะผะฐัะธะธ

### ะกัะตะฝะฐัะธะน 3: ะะปะฐะฝะธัะพะฒะฐะฝะธะต ั ััััะพะผ ัะตะผะฟะตัะฐัััั
1. **Temperature Map** โ ะะพัะผะพััะธัะต ัะตะผะฟะตัะฐัััั ัะตัะผั
2. **Analytics** โ **Farm Weather** โ ะัะพะณะฝะพะท ะฝะฐ 7 ะดะฝะตะน
3. **Map** โ ะัะฑะตัะธัะต ัะตััะธัะพัะธั โ **View AI Plan**
4. ะะปะฐะฝะธััะนัะต ัะฐะฑะพัั ั ััััะพะผ ะฟะพะณะพะดะฝัั ััะปะพะฒะธะน

## ๐ ะะฝัะตะณัะฐัะธั ั ะดััะณะธะผะธ ััะฝะบัะธัะผะธ

### ะกะฒัะทั ั Analytics:
- Temperature Map ะฟะพะบะฐะทัะฒะฐะตั **ัะตะบัััั** ัะตะผะฟะตัะฐัััั
- Analytics Farm Weather ะฟะพะบะฐะทัะฒะฐะตั **ะธััะพัะธั** (30 ะดะฝะตะน) ะธ **ะฟัะพะณะฝะพะท** (7 ะดะฝะตะน)
- ะะพะพัะดะธะฝะฐัั ัะตััะธัะพัะธะธ ะธัะฟะพะปัะทััััั ะฒ ะพะฑะพะธั ะผะตััะฐั

### ะกะฒัะทั ั AI Plan:
- ะขะตะผะฟะตัะฐัััะฐ ะฒะปะธัะตั ะฝะฐ ะฒัะฟะพะปะฝะตะฝะธะต ะทะฐะดะฐั AI ะฟะปะฐะฝะฐ
- ะะตะบะพะผะตะฝะดะฐัะธะธ ะฟะพ ะฟะพะปะธะฒั ะทะฐะฒะธััั ะพั ัะตะผะฟะตัะฐัััั
- ะะพะถะฝะพ ะพััะปะตะถะธะฒะฐัั ััะปะพะฒะธั ะดะปั ะพะฟัะธะผะฐะปัะฝะพะณะพ ัะพััะฐ

## ๐ ะะฑะฝะพะฒะปะตะฝะธะต ะดะฐะฝะฝัั

| ะะฐะฝะฝัะต | ะััะพัะฝะธะบ | ะะฑะฝะพะฒะปะตะฝะธะต |
|--------|----------|------------|
| Temperature Points | Open-Meteo API | ะัะธ ะฟะตัะตะบะปััะตะฝะธะธ ะฝะฐ temp map |
| Territories | LocalStorage | ะัะธ ะทะฐะณััะทะบะต ัััะฐะฝะธัั |
| Territory Temp | ะะฐัััั ะธะท tempPoints | Real-time ะฟัะธ ะบะปะธะบะต |

## ๐ ะัะตะธะผััะตััะฒะฐ

1. โ **ะะธะทัะฐะปะธะทะฐัะธั** - ะกัะฐะทั ะฒะธะดะฝะพ ัะตะผะฟะตัะฐัััั ะฝะฐ ะบะฐััะต
2. โ **ะะฝัะตัะฐะบัะธะฒะฝะพััั** - ะะปะธะบ ะฝะฐ ัะตััะธัะพัะธั โ ะดะตัะฐะปะธ
3. โ **ะะพะฝัะตะบัั** - ะขะตะผะฟะตัะฐัััะฐ ะฟะพะบะฐะทะฐะฝะฐ ะฒะผะตััะต ั ะธะฝัะพ ะพ ัะตัะผะต
4. โ **ะฃะดะพะฑััะฒะพ** - ะกะฟะธัะพะบ ะฒัะตั ัะตััะธัะพัะธะน ั ัะตะผะฟะตัะฐัััะฐะผะธ
5. โ **ะฆะฒะตัะพะฒะฐั ะธะฝะดะธะบะฐัะธั** - ะฅะพะปะพะดะฝัะต ะทะพะฝั ัะธะฝะธะต, ััะฟะปัะต ะบัะฐัะฝัะต

## ๐ฑ ะะดะฐะฟัะธะฒะฝะพััั

- **Desktop**: Sidebar ัะฟัะฐะฒะฐ ั ะฟะพะปะฝัะผ ัะฟะธัะบะพะผ ัะตััะธัะพัะธะน
- **Mobile**: ะกะฟะธัะพะบ ัะตััะธัะพัะธะน ะฒ ะพัะดะตะปัะฝะพะน ะบะฐััะพัะบะต
- **Popup**: ะะดะฐะฟัะธะฒะฝัะน ัะฐะทะผะตั ะฟะพะด ัะพะดะตัะถะธะผะพะต

## ๐ก๏ธ ะะฑัะฐะฑะพัะบะฐ ะพัะธะฑะพะบ

1. **ะะตั ัะตะผะฟะตัะฐัััะฝัั ะดะฐะฝะฝัั**: `temp = null` โ ะฝะต ะฟะพะบะฐะทัะฒะฐะตััั
2. **ะะตั ะบะพะพัะดะธะฝะฐั ัะตััะธัะพัะธะธ**: `return null`
3. **ะัััะพะน ะผะฐััะธะฒ tempPoints**: ะคัะฝะบัะธั ะฒะพะทะฒัะฐัะฐะตั `null`
4. **API ะฝะตะดะพัััะฟะตะฝ**: ะะพะบะฐะทัะฒะฐะตััั error message ะฒ sidebar

## ๐ฎ ะะพะทะผะพะถะฝัะต ัะปัััะตะฝะธั

1. ะกัะตะดะฝัั ัะตะผะฟะตัะฐัััะฐ ะฟะพ ะฒัะตะน ะฟะปะพัะฐะดะธ ัะตััะธัะพัะธะธ (ะฝะต ัะพะปัะบะพ ัะตะฝัั)
2. ะััะพัะธั ัะตะผะฟะตัะฐััั ะดะปั ัะตััะธัะพัะธะธ
3. ะัะตะดัะฟัะตะถะดะตะฝะธั ะพ ะบัะธัะธัะตัะบะธั ัะตะผะฟะตัะฐัััะฐั
4. ะะตะบะพะผะตะฝะดะฐัะธะธ ะฟะพ AI ะฟะปะฐะฝั ะฝะฐ ะพัะฝะพะฒะต ัะตะผะฟะตัะฐัััั
5. ะญะบัะฟะพัั ัะตะผะฟะตัะฐัััะฝัั ะดะฐะฝะฝัั ะดะปั ัะตััะธัะพัะธะธ

## ๐ ะกะฒัะทะฐะฝะฝัะต ัะฐะนะปั

- `MapPage.tsx` - ะัะฝะพะฒะฝะฐั ัะตะฐะปะธะทะฐัะธั
- `Analytics.tsx` - ะััะพัะธัะตัะบะฐั ะฟะพะณะพะดะฐ ะธ ะฟัะพะณะฝะพะท
- `Alerts.tsx` - ะฃะฒะตะดะพะผะปะตะฝะธั ะฟะพ AI ะฟะปะฐะฝั



